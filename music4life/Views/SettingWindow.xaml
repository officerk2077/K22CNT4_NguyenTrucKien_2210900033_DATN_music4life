<Window x:Class="music4life.Views.SettingWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Settings" Height="550" Width="700"
        WindowStartupLocation="CenterOwner"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="NoResize">

    <Window.Resources>
        <Style x:Key="PrimaryBtnStyle" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource Brush.Accent}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Height" Value="36"/>
            <Setter Property="Padding" Value="20,0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bd" Background="{TemplateBinding Background}" CornerRadius="18">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#48CAE4"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#0077B6"/>
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.95" ScaleY="0.95"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SecondaryBtnStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="BorderBrush" Value="#555"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Height" Value="36"/>
            <Setter Property="Padding" Value="15,0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bd" Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}" 
                                BorderThickness="{TemplateBinding BorderThickness}" 
                                CornerRadius="18">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#333"/>
                                <Setter TargetName="bd" Property="BorderBrush" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#222"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="IconOnlyBtnStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#AAA"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Width" Value="30"/>
            <Setter Property="Height" Value="30"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bd" Background="{TemplateBinding Background}" CornerRadius="15">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#333"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#222"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Border Background="{StaticResource Brush.Bg.Secondary}" CornerRadius="10" BorderBrush="{StaticResource Brush.Border}" BorderThickness="1">
        <Border.Effect>
            <DropShadowEffect BlurRadius="30" ShadowDepth="5" Opacity="0.5" Direction="270"/>
        </Border.Effect>

        <Grid Margin="30">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Grid Grid.Row="0" Margin="0,0,0,25">
                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <Path Data="M19.14,12.94C19.17,12.63 19.17,12.31 19.17,12C19.17,11.69 19.17,11.37 19.14,11.06L21.16,9.47C21.34,9.33 21.4,9.08 21.27,8.87L19.36,5.55C19.24,5.33 19,5.26 18.78,5.33L16.4,6.29C15.9,5.91 15.38,5.6 14.81,5.36L14.46,2.83C14.42,2.6 14.21,2.44 13.97,2.44H10.15C9.91,2.44 9.7,2.6 9.66,2.83L9.31,5.36C8.74,5.6 8.22,5.91 7.72,6.29L5.34,5.33C5.12,5.26 4.88,5.33 4.76,5.55L2.85,8.87C2.72,9.08 2.78,9.33 2.96,9.47L4.98,11.06C4.95,11.37 4.95,11.69 4.95,12C4.95,12.31 4.95,12.63 4.98,12.94L2.96,14.53C2.78,14.67 2.72,14.92 2.85,15.13L4.76,18.45C4.88,18.67 5.12,18.74 5.34,18.67L7.72,17.71C8.22,18.09 8.74,18.4 9.31,18.64L9.66,21.17C9.7,21.4 9.91,21.56 10.15,21.56H13.97C14.21,21.56 14.42,21.4 14.46,21.17L14.81,18.64C15.38,18.4 15.9,18.09 16.4,17.71L18.78,18.67C19,18.74 19.24,18.67 19.36,18.45L21.27,15.13C21.4,14.92 21.34,14.67 21.16,14.53L19.14,12.94V12.94M12,15.6C10.01,15.6 8.4,13.99 8.4,12C8.4,10.01 10.01,8.4 12,8.4C13.99,8.4 15.6,10.01 15.6,12C15.6,13.99 13.99,15.6 12,15.6Z" 
                          Fill="White" Width="22" Height="22" Stretch="Uniform" Margin="0,0,15,0"/>
                    <TextBlock Text="Cài đặt" FontSize="22" FontWeight="Bold" Foreground="White"/>
                </StackPanel>

                <Button Content="✕" HorizontalAlignment="Right" VerticalAlignment="Top" 
                        Style="{StaticResource IconOnlyBtnStyle}" FontSize="16" FontWeight="Bold" Click="BtnClose_Click"/>
            </Grid>

            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Hidden" Margin="0,0,0,20">
                <StackPanel>

                    <TextBlock Text="THƯ VIỆN NHẠC" Foreground="{StaticResource Brush.Accent}" FontWeight="Bold" FontSize="12" Margin="0,0,0,10"/>
                    <TextBlock Text="Chọn các thư mục trên máy tính để ứng dụng quét nhạc:" Foreground="{StaticResource Brush.Text.Secondary}" Margin="0,0,0,15"/>

                    <Border Background="{StaticResource Brush.Bg.Tertiary}" CornerRadius="8" Padding="15">
                        <StackPanel>
                            <ItemsControl ItemsSource="{Binding MusicFolders}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="0,0,0,10">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>

                                            <Path Data="M10,4H4C2.89,4 2,4.89 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V8C22,6.89 21.1,6 20,6H12L10,4Z" 
                                                  Fill="#F8D775" Width="20" Height="20" Stretch="Uniform" Margin="0,0,15,0"/>

                                            <TextBlock Grid.Column="1" Text="{Binding}" Foreground="White" VerticalAlignment="Center" FontSize="14" TextTrimming="CharacterEllipsis"/>

                                            <Button Grid.Column="2" Style="{StaticResource IconOnlyBtnStyle}" ToolTip="Xóa"
                                                    Command="{Binding DataContext.RemoveFolderCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}">
                                                <Path Data="M9,3V4H4V6H5V19A2,2 0 0,0 7,21H17A2,2 0 0,0 19,19V6H20V4H15V3H9M7,6H17V19H7V6M9,8V17H11V8H9M13,8V17H15V8H13Z" 
                                                      Fill="#FF5555" Width="14" Height="14" Stretch="Uniform"/>
                                            </Button>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <Rectangle Height="1" Fill="#3E3E3E" Margin="0,5,0,15"/>

                            <StackPanel Orientation="Horizontal">
                                <Button Style="{StaticResource PrimaryBtnStyle}" Margin="0,0,10,0" Width="140"
                                        Command="{Binding AddFolderCommand}">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="+" FontWeight="Bold" Margin="0,0,8,0" FontSize="16" VerticalAlignment="Center"/>
                                        <TextBlock Text="Thêm Thư Mục" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>

                                <Button Style="{StaticResource SecondaryBtnStyle}" Width="140"
                                        Command="{Binding RescanCommand}">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="↻" FontWeight="Bold" Margin="0,0,8,0" FontSize="16" VerticalAlignment="Center"/>
                                        <TextBlock Text="Quét Lại" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <StackPanel Grid.Row="1" Margin="0,25,0,0">
                        <TextBlock Text="HỆ THỐNG &amp; PLAYBACK" Foreground="{StaticResource Brush.Accent}" FontWeight="Bold" FontSize="12" Margin="0,0,0,10"/>

                        <Grid Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                    <TextBlock Text="CrossFade: " Foreground="White" FontWeight="SemiBold"/>
                                    <TextBlock Text="{Binding ElementName=slCrossfade, Path=Value, StringFormat={}{0:0}s}" 
                                               Foreground="{StaticResource Brush.Accent}" FontWeight="Bold"/>
                                </StackPanel>
                                <TextBlock Text="Tự động giảm âm lượng khi chuyển bài" Foreground="{StaticResource Brush.Text.Secondary}" FontSize="12"/>
                            </StackPanel>

                            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Width="220" HorizontalAlignment="Right">
                                <TextBlock Text="Tắt" Foreground="{StaticResource Brush.Text.Secondary}" FontSize="12" VerticalAlignment="Center" Margin="0,0,10,0"/>

                                <Slider x:Name="slCrossfade" 
                                        Width="140" Maximum="12" Minimum="0" 
                                        Value="{Binding CrossfadeSeconds, UpdateSourceTrigger=PropertyChanged}"
                                        TickFrequency="1" IsSnapToTickEnabled="True"
                                        
                                        Style="{StaticResource ModernSliderStyle}"
                                        AutoToolTipPlacement="TopLeft" 
                                        AutoToolTipPrecision="0"
                                        
                                        VerticalAlignment="Center"/>

                                <TextBlock Text="12s" Foreground="{StaticResource Brush.Text.Secondary}" FontSize="12" VerticalAlignment="Center" Margin="10,0,0,0"/>
                            </StackPanel>
                        </Grid>

                        <Rectangle Height="1" Fill="#333" Margin="0,5,0,15"/>

                        <StackPanel>
                            <CheckBox Content="Thu nhỏ xuống khay hệ thống (System Tray)" 
                                      IsChecked="{Binding IsMinimizeToTrayEnabled}"
                                      Foreground="White" Margin="0,8" Cursor="Hand" FontSize="14"/>
                        </StackPanel>
                    </StackPanel>
                </StackPanel>
            </ScrollViewer>

            <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Content="Huỷ" Style="{StaticResource SecondaryBtnStyle}" BorderThickness="0" 
                        Width="80" Margin="0,0,10,0" Foreground="#AAA" Click="BtnClose_Click"/>

                <Button Content="Lưu Cài Đặt" Style="{StaticResource PrimaryBtnStyle}" 
                        Width="140" Command="{Binding SaveSettingsCommand}"
                        CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"/>
            </StackPanel>
        </Grid>
    </Border>
</Window>   