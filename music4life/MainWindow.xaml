<Window x:Class="music4life.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:views="clr-namespace:music4life.Views" 
        mc:Ignorable="d"
        Title="Windows Music Player" Height="768" Width="1280"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        ResizeMode="CanResize"
        Background="{StaticResource Brush.Bg.Main}">

    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="0" 
                      ResizeBorderThickness="5" 
                      CornerRadius="0" 
                      GlassFrameThickness="0"
                      UseAeroCaptionButtons="False"/>
    </WindowChrome.WindowChrome>

    <Window.Resources>
        <Style x:Key="DarkContextMenuStyle" TargetType="{x:Type ContextMenu}">
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="OverridesDefaultStyle" Value="True" />
            <Setter Property="Grid.IsSharedSizeScope" Value="true" />
            <Setter Property="HasDropShadow" Value="True" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ContextMenu}">
                        <Border x:Name="Border" Background="#2B2B2B" BorderThickness="1" BorderBrush="#444444" CornerRadius="6" Padding="0,4">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="10" ShadowDepth="3" Opacity="0.4" Color="Black"/>
                            </Border.Effect>
                            <StackPanel IsItemsHost="True" KeyboardNavigation.DirectionalNavigation="Cycle" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="DarkMenuItemStyle" TargetType="{x:Type MenuItem}">
            <Setter Property="SnapsToDevicePixels" Value="True" />
            <Setter Property="OverridesDefaultStyle" Value="True" />
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#E0E0E0"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type MenuItem}">
                        <Border x:Name="Border" Background="{TemplateBinding Background}" BorderThickness="0" Padding="15,8">
                            <ContentPresenter ContentSource="Header"
                                              HorizontalAlignment="Left"
                                              VerticalAlignment="Center"
                                              RecognizesAccessKey="True"
                                              SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsHighlighted" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#3A3A3A"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="#666"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SidebarBtnStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource Brush.Text.Secondary}"/>
            <Setter Property="Height" Value="40"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="Padding" Value="20,0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Margin" Value="0,2"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="4">
                            <ContentPresenter VerticalAlignment="Center" Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="PlayerBtnStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#E0E0E0"/>
            <Setter Property="Width" Value="34"/>
            <Setter Property="Height" Value="34"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" Background="{TemplateBinding Background}" CornerRadius="17">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#333333"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#222222"/>
                                <Setter Property="RenderTransform">
                                    <Setter.Value>
                                        <ScaleTransform ScaleX="0.95" ScaleY="0.95"/>
                                    </Setter.Value>
                                </Setter>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="TitleBarBtnStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#B3B3B3"/>
            <Setter Property="Width" Value="46"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bd" Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#333333"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#222222"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="CloseBtnStyle" TargetType="Button" BasedOn="{StaticResource TitleBarBtnStyle}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="bd" Background="{TemplateBinding Background}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#E81123"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="bd" Property="Background" Value="#B90D1C"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ModernSliderStyle" TargetType="Slider">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Slider">
                        <Grid VerticalAlignment="Center">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto" MinHeight="{TemplateBinding MinHeight}"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Track x:Name="PART_Track" Grid.Row="1">
                                <Track.DecreaseRepeatButton>
                                    <RepeatButton Command="{x:Static Slider.DecreaseLarge}">
                                        <RepeatButton.Style>
                                            <Style TargetType="RepeatButton">
                                                <Setter Property="OverridesDefaultStyle" Value="True"/>
                                                <Setter Property="Background" Value="#00ADEF"/>
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="RepeatButton">
                                                            <Border Background="{TemplateBinding Background}" Height="4" CornerRadius="2"/>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </RepeatButton.Style>
                                    </RepeatButton>
                                </Track.DecreaseRepeatButton>
                                <Track.IncreaseRepeatButton>
                                    <RepeatButton Command="{x:Static Slider.IncreaseLarge}">
                                        <RepeatButton.Style>
                                            <Style TargetType="RepeatButton">
                                                <Setter Property="OverridesDefaultStyle" Value="True"/>
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="RepeatButton">
                                                            <Border Background="#444444" Height="4" CornerRadius="2"/>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </RepeatButton.Style>
                                    </RepeatButton>
                                </Track.IncreaseRepeatButton>
                                <Track.Thumb>
                                    <Thumb>
                                        <Thumb.Style>
                                            <Style TargetType="Thumb">
                                                <Setter Property="OverridesDefaultStyle" Value="True"/>
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="Thumb">
                                                            <Grid>
                                                                <Ellipse Fill="White" Width="14" Height="14"/>
                                                            </Grid>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </Thumb.Style>
                                    </Thumb>
                                </Track.Thumb>
                            </Track>
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.Style>
            <Style TargetType="Grid">
                <Setter Property="Margin" Value="0"/>
                <Style.Triggers>
                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=WindowState}" Value="Maximized">
                        <Setter Property="Margin" Value="{Binding Source={x:Static SystemParameters.WindowResizeBorderThickness}}"/>
                    </DataTrigger>
                </Style.Triggers>
            </Style>
        </Grid.Style>

        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="100"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="280"/>
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Background="{StaticResource Brush.Bg.Secondary}" BorderBrush="{StaticResource Brush.Border}" BorderThickness="0,0,1,0">
                <Grid Margin="0,15,0,15">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0">
                        <Grid Margin="15,0,15,20">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Background="{StaticResource Brush.Bg.Tertiary}" CornerRadius="18" Height="35">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Text="🔍" VerticalAlignment="Center" Margin="10,0,5,0" Foreground="{StaticResource Brush.Text.Secondary}"/>
                                    <TextBox Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                                             Background="Transparent" BorderThickness="0" VerticalAlignment="Center" Grid.Column="1"
                                             Foreground="{StaticResource Brush.Text.Secondary}" CaretBrush="White"
                                             Tag="Find songs..." Style="{DynamicResource {x:Type TextBox}}"/>
                                </Grid>
                            </Border>
                        </Grid>

                        <TextBlock Text="Thư viện" Foreground="{StaticResource Brush.Text.Secondary}" FontWeight="Bold" FontSize="11" Margin="20,0,0,8"/>

                        <StackPanel>
                            <Button Style="{StaticResource SidebarBtnStyle}" Click="BtnAllSongs_Click">
                                <StackPanel Orientation="Horizontal">
                                    <Path Data="M12,3V12.26C11.5,12.09 11,12 10.5,12C8,12 6,14 6,16.5C6,19 8,21 10.5,21C13,21 15,19 15,16.5V6H19V3H12Z" 
                                          Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}" 
                                          Width="16" Height="16" Stretch="Uniform" Margin="0,0,15,0"/>
                                    <TextBlock Text="Tất cả bài hát" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <Button Style="{StaticResource SidebarBtnStyle}" Click="BtnArtists_Click">
                                <StackPanel Orientation="Horizontal">
                                    <Path Data="M12,2A3,3 0 0,1 15,5V11A3,3 0 0,1 12,14A3,3 0 0,1 9,11V5A3,3 0 0,1 12,2M19,11C19,14.53 16.39,17.44 13,17.93V21H11V17.93C7.61,17.44 5,14.53 5,11H7A5,5 0 0,0 12,16A5,5 0 0,0 17,11H19Z" 
                                          Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}" 
                                          Width="16" Height="16" Stretch="Uniform" Margin="0,0,15,0"/>
                                    <TextBlock Text="Nghệ sĩ" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <Button Style="{StaticResource SidebarBtnStyle}" Click="BtnAlbums_Click">
                                <StackPanel Orientation="Horizontal">
                                    <Path Data="M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2M12,7A5,5 0 0,0 7,12A5,5 0 0,0 12,17A5,5 0 0,0 17,12A5,5 0 0,0 12,7M12,9A3,3 0 0,1 15,12A3,3 0 0,1 12,15A3,3 0 0,1 9,12A3,3 0 0,1 12,9Z" 
                                          Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}" 
                                          Width="16" Height="16" Stretch="Uniform" Margin="0,0,15,0"/>
                                    <TextBlock Text="Albums" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <Button Style="{StaticResource SidebarBtnStyle}" Click="BtnGenres_Click">
                                <StackPanel Orientation="Horizontal">
                                    <Path Data="M5.5,7A1.5,1.5 0 0,1 4,5.5A1.5,1.5 0 0,1 7,5.5A1.5,1.5 0 0,1 5.5,7M21.41,11.58L12.41,2.58C12.05,2.22 11.55,2 11,2H4C2.89,2 2,2.89 2,4V11C2,11.55 2.22,12.05 2.58,12.41L11.58,21.41C11.95,21.77 12.45,22 13,22C13.55,22 14.05,21.77 14.41,21.41L21.41,14.41C21.78,14.05 22,13.55 22,13C22,12.45 21.77,11.94 21.41,11.58Z" 
                                          Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}" 
                                          Width="16" Height="16" Stretch="Uniform" Margin="0,0,15,0"/>
                                    <TextBlock Text="Thể loại" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>

                        <TextBlock Text="Danh sách phát" Foreground="{StaticResource Brush.Text.Secondary}" FontWeight="Bold" FontSize="11" Margin="20,25,0,8"/>
                        <Button Style="{StaticResource SidebarBtnStyle}" Click="BtnNewPlaylist_Click">
                            <StackPanel Orientation="Horizontal">
                                <Path Data="M19,13H13V19H11V13H5V11H11V5H13V11H19V13Z" 
                                      Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}" 
                                      Width="16" Height="16" Stretch="Uniform" Margin="0,0,15,0"/>
                                <TextBlock Text="Tạo danh sách phát" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>

                        <ScrollViewer VerticalScrollBarVisibility="Auto" Margin="0,5,0,0" MaxHeight="300" BorderThickness="0" Background="Transparent">
                            <ItemsControl ItemsSource="{Binding UserPlaylists}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Button Style="{StaticResource SidebarBtnStyle}" 
                Command="{Binding DataContext.OpenPlaylistCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                CommandParameter="{Binding}"
                Tag="{Binding DataContext, RelativeSource={RelativeSource AncestorType=Window}}">

                                            <Button.ContextMenu>
                                                <ContextMenu Style="{DynamicResource DarkContextMenuStyle}">
                                                    <MenuItem Header="Đổi tên" 
                                                      Foreground="#E0E0E0"
                                                      Style="{DynamicResource DarkMenuItemStyle}"
                                                      Command="{Binding PlacementTarget.Tag.RenamePlaylistCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                                      CommandParameter="{Binding}"/>

                                                    <MenuItem Header="Xóa Playlist" 
                                                      Foreground="#FF5555"
                                                      Style="{DynamicResource DarkMenuItemStyle}"
                                                      Command="{Binding PlacementTarget.Tag.DeletePlaylistCommand, RelativeSource={RelativeSource AncestorType=ContextMenu}}"
                                                      CommandParameter="{Binding}"/>
                                                </ContextMenu>
                                            </Button.ContextMenu>

                                            <StackPanel Orientation="Horizontal">
                                                <Path Data="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M15,13H13V15H11V13H9V11H11V9H13V11H15V13Z" 
                                                  Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}" 
                                                  Width="14" Height="14" Stretch="Uniform" Margin="0,0,15,0" Opacity="0.7"/>

                                                <TextBlock Text="{Binding Name}" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                                            </StackPanel>
                                        </Button>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </ScrollViewer>

                        <Button Style="{StaticResource SidebarBtnStyle}" Command="{Binding ShowFavoritesCommand}">
                            <StackPanel Orientation="Horizontal">
                                <Path Data="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z" 
                                      Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}" 
                                      Width="16" Height="16" Stretch="Uniform" Margin="0,0,15,0"/>
                                <TextBlock Text="Ưa thích" VerticalAlignment="Center"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>

                    <Button Grid.Row="1" Style="{StaticResource SidebarBtnStyle}" Click="BtnSettings_Click">
                        <StackPanel Orientation="Horizontal">
                            <Path Data="M19.14,12.94C19.17,12.63 19.17,12.31 19.17,12C19.17,11.69 19.17,11.37 19.14,11.06L21.16,9.47C21.34,9.33 21.4,9.08 21.27,8.87L19.36,5.55C19.24,5.33 19,5.26 18.78,5.33L16.4,6.29C15.9,5.91 15.38,5.6 14.81,5.36L14.46,2.83C14.42,2.6 14.21,2.44 13.97,2.44H10.15C9.91,2.44 9.7,2.6 9.66,2.83L9.31,5.36C8.74,5.6 8.22,5.91 7.72,6.29L5.34,5.33C5.12,5.26 4.88,5.33 4.76,5.55L2.85,8.87C2.72,9.08 2.78,9.33 2.96,9.47L4.98,11.06C4.95,11.37 4.95,11.69 4.95,12C4.95,12.31 4.95,12.63 4.98,12.94L2.96,14.53C2.78,14.67 2.72,14.92 2.85,15.13L4.76,18.45C4.88,18.67 5.12,18.74 5.34,18.67L7.72,17.71C8.22,18.09 8.74,18.4 9.31,18.64L9.66,21.17C9.7,21.4 9.91,21.56 10.15,21.56H13.97C14.21,21.56 14.42,21.4 14.46,21.17L14.81,18.64C15.38,18.4 15.9,18.09 16.4,17.71L18.78,18.67C19,18.74 19.24,18.67 19.36,18.45L21.27,15.13C21.4,14.92 21.34,14.67 21.16,14.53L19.14,12.94V12.94M12,15.6C10.01,15.6 8.4,13.99 8.4,12C8.4,10.01 10.01,8.4 12,8.4C13.99,8.4 15.6,10.01 15.6,12C15.6,13.99 13.99,15.6 12,15.6Z" 
                                  Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}" 
                                  Width="16" Height="16" Stretch="Uniform" Margin="0,0,15,0"/>
                            <TextBlock Text="Cài đặt" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </Grid>
            </Border>

            <ContentControl Grid.Column="1" Margin="20,10,0,10" x:Name="MainContent">
                <views:SongListView />
            </ContentControl>

            <Grid Grid.Column="2" Background="{StaticResource Brush.Bg.Secondary}">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" MinHeight="60"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="430" MinHeight="0"/>
                </Grid.RowDefinitions>

                <Border Grid.Row="0" BorderBrush="{StaticResource Brush.Border}" BorderThickness="0,0,0,0" Margin="15,15,15,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <TextBlock Text="Hàng chờ" FontWeight="Bold" Margin="0,0,0,10"/>

                        <ListBox Grid.Row="1" ItemsSource="{Binding PlayingQueue}" 
                                 Background="Transparent" BorderThickness="0" 
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled" 
                                 ScrollViewer.VerticalScrollBarVisibility="Hidden">
                            <ListBox.ItemContainerStyle>
                                <Style TargetType="ListBoxItem">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Padding" Value="0,5"/>
                                    <Setter Property="Cursor" Value="Hand"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="ListBoxItem">
                                                <Border Background="{TemplateBinding Background}" CornerRadius="4" Padding="5">
                                                    <ContentPresenter />
                                                </Border>
                                                <ControlTemplate.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="#22FFFFFF"/>
                                                    </Trigger>
                                                    <DataTrigger Binding="{Binding IsPlaying}" Value="True">
                                                        <Setter Property="Background" Value="#2200ADEF"/>
                                                        <Setter Property="Foreground" Value="#00ADEF"/>
                                                    </DataTrigger>
                                                </ControlTemplate.Triggers>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </ListBox.ItemContainerStyle>
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <StackPanel Grid.Column="0" VerticalAlignment="Center">
                                            <TextBlock Text="{Binding Title}" FontWeight="SemiBold" TextTrimming="CharacterEllipsis"/>
                                            <TextBlock Text="{Binding Artist}" FontSize="10" Foreground="{StaticResource Brush.Text.Secondary}" TextTrimming="CharacterEllipsis"/>
                                        </StackPanel>

                                        <TextBlock Grid.Column="1" Text="{Binding Duration}" FontSize="11" 
                                                   Foreground="{StaticResource Brush.Text.Secondary}" 
                                                   VerticalAlignment="Center" Margin="5,0,5,0"/>

                                        <Button Grid.Column="2" 
                                                Style="{StaticResource PlayerBtnStyle}" 
                                                Width="24" Height="24" 
                                                ToolTip="Xoá khỏi hàng chờ"
                                                Command="{Binding DataContext.RemoveFromQueueCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                CommandParameter="{Binding}">
                                            <Path Data="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" 
                                                  Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}" 
                                                  Stretch="Uniform" Width="10" Height="10"/>
                                        </Button>
                                    </Grid>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Grid>
                </Border>

                <GridSplitter Grid.Row="1" 
                              Height="8" 
                              HorizontalAlignment="Stretch" 
                              VerticalAlignment="Stretch" 
                              ResizeDirection="Rows" 
                              ResizeBehavior="PreviousAndNext"
                              Background="Transparent" 
                              Cursor="SizeNS"
                              ShowsPreview="False"
                              Panel.ZIndex="10"/>

                <Border Grid.Row="1" Height="2" Width="40" Background="#444" CornerRadius="1" IsHitTestVisible="False"/>

                <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Hidden" Margin="0,5,0,0">
                    <StackPanel Margin="20,0,20,20">
                        <StackPanel.Style>
                            <Style TargetType="StackPanel">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding SongTitle}" Value="Music for Life">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </StackPanel.Style>

                        <Border BorderBrush="{StaticResource Brush.Border}" BorderThickness="0,1,0,0" Margin="0,0,0,15"/>

                        <TextBlock Text="Thông tin" FontWeight="Bold" Foreground="#DDD" FontSize="14" Margin="0,0,0,10"/>

                        <TextBlock Text="{Binding SongTitle}" FontSize="16" FontWeight="SemiBold" TextTrimming="CharacterEllipsis" Foreground="#88CEEB" Margin="0,0,0,2"/>
                        <TextBlock Text="{Binding SongArtist}" FontSize="14" Foreground="#CCC" TextTrimming="CharacterEllipsis" Margin="0,0,0,2"/>
                        <TextBlock Text="{Binding SongAlbum}" FontSize="14" Foreground="#999" TextTrimming="CharacterEllipsis" Margin="0,0,0,2"/>
                        <TextBlock Text="{Binding SongYear}" FontSize="14" Foreground="#999" Margin="0,0,0,10"/>

                        <TextBlock Text="{Binding SongTechInfo}" FontSize="12" Foreground="#888" TextWrapping="Wrap" Margin="0,0,0,15"/>

                        <Border Width="240" Height="240" CornerRadius="0" Margin="0" HorizontalAlignment="Center"
                                RenderOptions.BitmapScalingMode="HighQuality">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Background">
                                        <Setter.Value>
                                            <ImageBrush ImageSource="{Binding SongCover}" Stretch="UniformToFill"/>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding SongCover}" Value="{x:Null}">
                                            <Setter Property="Background" Value="#333"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <Grid>
                                <Grid.Style>
                                    <Style TargetType="Grid">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SongCover}" Value="{x:Null}">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Grid.Style>
                                <Path Data="M12,3V12.26C11.5,12.09 11,12 10.5,12C8,12 6,14 6,16.5C6,19 8,21 10.5,21C13,21 15,19 15,16.5V6H19V3H12Z" 
                                      Fill="#555" Stretch="Uniform" Width="80" Height="80" 
                                      HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Grid>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Grid>

            <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,10,10,0" Panel.ZIndex="99">
                <Button Content="─" Style="{StaticResource TitleBarBtnStyle}" Click="BtnMinimize_Click"/>
                <Button Content="◻" Style="{StaticResource TitleBarBtnStyle}" Click="BtnMaximize_Click"/>
                <Button Content="✕" Style="{StaticResource CloseBtnStyle}" Click="BtnCloseApp_Click"/>
            </StackPanel>
        </Grid>

        <Border Grid.Row="1" Background="{StaticResource Brush.Bg.Secondary}" BorderBrush="{StaticResource Brush.Border}" BorderThickness="0,1,0,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="auto"/>
                </Grid.ColumnDefinitions>

                <Grid Grid.Column="0" Margin="30,18,30,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Bottom">
                        <Button Style="{StaticResource PlayerBtnStyle}" Margin="15,0" ToolTip="Previous" 
                                Command="{Binding PreviousCommand}">
                            <Path Data="M6,6H8V18H6M9.5,12L18,18V6L9.5,12Z" 
                                  Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}" 
                                  Stretch="Uniform" Height="14" Width="14"/>
                        </Button>

                        <Button Style="{StaticResource PlayerBtnStyle}" Margin="10,0" ToolTip="Play" Width="40" Height="40" Background="{StaticResource Brush.Accent}"
                                Command="{Binding PlayPauseCommand}">
                            <Grid>
                                <Path Data="M8,5.14V19.14L19,12.14L8,5.14Z" Fill="White" Stretch="Uniform" Height="16" Width="16" Margin="2,0,0,0">
                                    <Path.Style>
                                        <Style TargetType="Path">
                                            <Setter Property="Visibility" Value="Visible"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsPlaying}" Value="True">
                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Path.Style>
                                </Path>
                                <Path Data="M14,19H18V5H14M6,19H10V5H6V19Z" Fill="White" Stretch="Uniform" Height="16" Width="16">
                                    <Path.Style>
                                        <Style TargetType="Path">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsPlaying}" Value="True">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Path.Style>
                                </Path>
                            </Grid>
                        </Button>

                        <Button Style="{StaticResource PlayerBtnStyle}" Margin="15,0" ToolTip="Next"
                                Command="{Binding NextCommand}">
                            <Path Data="M16,6H18V18H16M6,18L14.5,12L6,6L6,18Z" 
                                  Fill="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}" 
                                  Stretch="Uniform" Height="14" Width="14"/>
                        </Button>
                    </StackPanel>

                    <Grid Grid.Row="1" VerticalAlignment="Top" Margin="0,5,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="auto"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="{Binding CurrentTime}" FontSize="11" Foreground="{StaticResource Brush.Text.Secondary}" VerticalAlignment="Center" Margin="0,0,10,0"/>

                        <Slider Grid.Column="1" 
                                x:Name="seekSlider" 
                                Style="{StaticResource ModernSliderStyle}" 
                                VerticalAlignment="Center" 
                                IsMoveToPointEnabled="True" 
                                Value="{Binding SliderValue}" 
                                Maximum="{Binding SliderMaximum}"
                                Thumb.DragStarted="Slider_DragStarted"
                                Thumb.DragCompleted="Slider_DragCompleted"
                                PreviewMouseLeftButtonUp="seekSlider_PreviewMouseLeftButtonUp"/>

                        <TextBlock Grid.Column="2" Text="{Binding RemainingTime}" FontSize="11" Foreground="{StaticResource Brush.Text.Secondary}" VerticalAlignment="Center" Margin="10,0,0,0"/>
                    </Grid>
                </Grid>

                <Grid Grid.Column="1" Width="Auto" MinWidth="280" Margin="0,15,20,15">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Right" MouseWheel="Volume_MouseWheel">
                        <Path Data="M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.84 14,18.7V20.77C18,19.86 21,16.28 21,12C21,7.72 18,4.14 14,3.23M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16.02C15.5,15.29 16.5,13.76 16.5,12M3,9V15H7L12,20V4L7,9H3Z" 
                              Fill="#B3B3B3" Height="16" Width="16" Margin="0,0,10,0" Stretch="Uniform"/>

                        <Slider x:Name="slVolume" Style="{StaticResource ModernSliderStyle}" Width="100" 
                                VerticalAlignment="Center" IsMoveToPointEnabled="True" 
                                Value="{Binding Volume}" Maximum="100" AutoToolTipPlacement="TopLeft"/>

                        <TextBlock Text="{Binding ElementName=slVolume, Path=Value, StringFormat={}{0:0}%}" 
                                   Foreground="{StaticResource Brush.Text.Secondary}" FontSize="12" 
                                   VerticalAlignment="Center" Margin="10,0,0,0" Width="30"/>
                    </StackPanel>

                    <StackPanel Grid.Row="1" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Right" Margin="0,0,0,0">

                        <Button Style="{StaticResource PlayerBtnStyle}" Margin="0,0,10,0" ToolTip="Favorite"
                                Command="{Binding ToggleFavoriteCommand}">
                            <Button.CommandParameter>
                                <Binding Path="SongInSidebar" />
                            </Button.CommandParameter>
                            <Path Data="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z" 
                                  Stretch="Uniform" Height="16" Width="16">
                                <Path.Style>
                                    <Style TargetType="Path">
                                        <Setter Property="Fill" Value="Transparent"/>
                                        <Setter Property="Stroke" Value="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}"/>
                                        <Setter Property="StrokeThickness" Value="1.5"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsInfoFavorite}" Value="True">
                                                <Setter Property="Fill" Value="#FF4081"/>
                                                <Setter Property="Stroke" Value="#FF4081"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Path.Style>
                            </Path>
                        </Button>

                        <Button Style="{StaticResource PlayerBtnStyle}" Margin="0,0,10,0" ToolTip="Shuffle"
                                Command="{Binding ShuffleCommand}">
                            <Path Data="M14.83,13.41L13.42,14.82L16.55,17.95L14.5,20H20V14.5L17.96,16.54L14.83,13.41M14.5,4L16.54,6.04L4,18.59L5.41,20L17.96,7.46L20,9.5V4M10.59,9.17L5.41,4L4,5.41L9.17,10.58L10.59,9.17Z" 
                                  Stretch="Uniform" Height="16" Width="16">
                                <Path.Style>
                                    <Style TargetType="Path">
                                        <Setter Property="Fill" Value="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsShuffle}" Value="True">
                                                <Setter Property="Fill" Value="#00ADEF"/>
                                                <Setter Property="Effect">
                                                    <Setter.Value>
                                                        <DropShadowEffect Color="#00ADEF" BlurRadius="10" ShadowDepth="0" Opacity="0.8"/>
                                                    </Setter.Value>
                                                </Setter>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Path.Style>
                            </Path>
                        </Button>

                        <Button Style="{StaticResource PlayerBtnStyle}" Margin="0,0,0,0" ToolTip="Repeat Mode"
                                Command="{Binding ToggleRepeatCommand}">
                            <Grid>
                                <Path x:Name="iconRepeat" 
                                    Data="M17,17H7V14L3,18L7,22V19H19V13H17M7,7H17V10L21,6L17,2V5H5V11H7V7Z" 
                                    Stretch="Uniform" Height="20" Width="20">
                                    <Path.Style>
                                        <Style TargetType="Path">
                                            <Setter Property="Fill" Value="{Binding RelativeSource={RelativeSource AncestorType=Button}, Path=Foreground}"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding CurrentRepeatMode}" Value="RepeatAll">
                                                    <Setter Property="Fill" Value="#00ADEF"/>
                                                    <Setter Property="Effect">
                                                        <Setter.Value>
                                                            <DropShadowEffect Color="#00ADEF" BlurRadius="10" ShadowDepth="0" Opacity="0.8"/>
                                                        </Setter.Value>
                                                    </Setter>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding CurrentRepeatMode}" Value="RepeatOne">
                                                    <Setter Property="Fill" Value="#00ADEF"/>
                                                    <Setter Property="Effect">
                                                        <Setter.Value>
                                                            <DropShadowEffect Color="#00ADEF" BlurRadius="10" ShadowDepth="0" Opacity="0.8"/>
                                                        </Setter.Value>
                                                    </Setter>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Path.Style>
                                </Path>

                                <TextBlock Text="1" FontSize="9" FontWeight="Black" 
                                           HorizontalAlignment="Center" VerticalAlignment="Center" 
                                           Margin="0,-1,0,0" IsHitTestVisible="False">
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                            <Setter Property="Foreground" Value="#00ADEF"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding CurrentRepeatMode}" Value="RepeatOne">
                                                    <Setter Property="Visibility" Value="Visible"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                    <TextBlock.Effect>
                                        <DropShadowEffect ShadowDepth="0" BlurRadius="2" Color="Black" Opacity="1"/>
                                    </TextBlock.Effect>
                                </TextBlock>
                            </Grid>
                        </Button>
                    </StackPanel>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</Window>